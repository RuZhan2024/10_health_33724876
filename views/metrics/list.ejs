<%- include('../partials/header', { pageTitle: pageTitle || 'My Health Metrics' }) %>

<section class="metrics">
  <h2>My Health Metrics</h2>

  <div class="metrics-actions">
    <a href="/metrics/add" class="btn">Add Metric</a>
  </div>

  <section class="metrics-filters">
    <h3>Filter</h3>
    <form method="GET" action="/metrics">
      <div class="form-row">
        <div class="form-group">
          <label for="type">Metric type</label>
          <select name="type" id="type">
            <option value="">All types</option>
            <% metricTypes.forEach(t => { %>
              <option value="<%= t.id %>" <%= String(filters.type) === String(t.id) ? 'selected' : '' %>>
                <%= t.name %>
              </option>
            <% }) %>
          </select>
        </div>

        <div class="form-group">
          <label for="from">From date</label>
          <input
            type="date"
            id="from"
            name="from"
            value="<%= filters.from || '' %>"
          />
        </div>

        <div class="form-group">
          <label for="to">To date</label>
          <input
            type="date"
            id="to"
            name="to"
            value="<%= filters.to || '' %>"
          />
        </div>

        <div class="form-group">
          <label>&nbsp;</label>
          <button type="submit" class="btn">Apply</button>
        </div>
      </div>
    </form>
  </section>

  <section class="metrics-list">
    <% if (!metrics.length) { %>
      <p>No metrics found. Try adjusting your filters or
        <a href="/metrics/add">add a new metric</a>.
      </p>
    <% } else { %>
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Metric</th>
            <th>Value</th>
            <th>Notes</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% metrics.forEach(m => { %>
            <tr>
              <td><%= m.metric_date_str %></td>
              <td><%= m.metric_type_name %></td>
              <td><%= m.value %> <%= m.unit %></td>
              <td><%= m.notes || '' %></td>
              <td>
                <a href="/metrics/<%= m.id %>/edit">Edit</a>
                <form
                  action="/metrics/<%= m.id %>/delete"
                  method="POST"
                  style="display:inline"
                  onsubmit="return confirm('Delete this metric?');"
                >
                  <button type="submit" class="link-button">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } %>
  </section>
</section>

<%- include('../partials/footer') %>
